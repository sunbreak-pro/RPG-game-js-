var Be=Object.defineProperty;var be=(e,t,n)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var i=(e,t,n)=>be(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();let H=null,S=null;const Q=document.getElementById("tittle-log"),ue=document.getElementById("next-stage"),E=document.getElementById("background-area");function de(e){Q.innerHTML+=`<h3>
 ${e}</h3>`}function f(e="",t=""){const s=ue.style.display!=="none"?S:H;s&&(e&&(s.innerHTML+=`<p>
<strong>${e}</strong></p>`,E.innerHTML+=`<p>
${e}</p>`),t&&(s.innerHTML+=`<p>
<strong>${t}</strong></p>`,E.innerHTML+=`<p>
${t}</p>`),s.scrollTo({top:s.scrollHeight,behavior:"smooth"}),console.log(s))}function r(e,t=""){const s=ue.style.display!=="none"?S:H;s&&(e&&(s.innerHTML+=`<p>
<strong>${e}</strong></p>`,E.innerHTML+=`<p>
${e}</p>`),t&&(s.innerHTML+=`<p>
<strong>${t}</strong></p>`,E.innerHTML+=`<p>
${t}</p>`),E.scrollTo({top:E.scrollHeight,behavior:"smooth"}))}function ye(){H&&(H.innerHTML=""),S&&(S.innerHTML=""),Q.innerHTML=""}function he(){H&&(H.innerHTML=""),S&&(S.innerHTML=""),E.innerHTML="",Q.innerHTML=""}function Pe({battleLog:e,afterBattleLog:t}){H=e,S=t}const ke=[{className:"戦士",hp:130,mp:30,physicalStrength:50,magicalStrength:15,defense:25,speed:20},{className:"魔法使い",hp:80,mp:80,physicalStrength:15,magicalStrength:50,defense:20,speed:25}],k=[{name:"スライム",className:"monster",hp:100,mp:0,physicalStrength:40,magicalStrength:0,defense:15,speed:20},{name:"ゴブリン",className:"monster",hp:120,mp:30,physicalStrength:50,magicalStrength:10,defense:20,speed:20},{name:"オーク",className:"monster",hp:150,mp:35,physicalStrength:60,magicalStrength:15,defense:30,speed:20},{name:"リッチ",className:"monster",hp:300,mp:200,physicalStrength:70,magicalStrength:100,defense:18,speed:50},{name:"ドラゴン",className:"monster",hp:500,mp:200,physicalStrength:80,magicalStrength:70,defense:80,speed:50},{name:"ダンジョンボス",className:"monster",hp:1e3,mp:500,physicalStrength:100,magicalStrength:100,defense:100,speed:20}],A=document.getElementById("instruction-border"),ve=document.getElementById("instruction");function y({playerStatus:e,enemyStatus:t,healItemsDiv:n,equipItemsDiv:s,equippedDiv:a}=d){const o=g();let l;if(o instanceof Object&&"inventory"in o)l=o;else return;const u=v();e.textContent=l.getPlayerStatus(),t.textContent=u.getEnemyStatus(),n.innerHTML="",s.innerHTML="";let $=!1,b=!1;l.inventory.forEach(c=>{if(c.amount<=0)return;const p=document.createElement("button");p.textContent=`${c.showAmount()}`,p.addEventListener("mouseenter",()=>{A.style.display="block",ve.innerText=c.instructionText}),p.addEventListener("mouseleave",()=>{A.style.display="none"}),p.addEventListener("click",()=>{if(A.style.display="none",["hpHeal","mpHeal","bothHeal"].includes(c.itemType)){if(c.itemType==="hpHeal"&&l.hp===l.maxHp)return f("HPがMAXなため、薬は使用不可");if(c.itemType==="mpHeal"&&l.mp===l.maxMp)return f("MPがMAXなため、薬は使用不可");l.healItem(c)}else c.itemType==="equipment"&&(l.equipItem(c),c.isEquipped=!0);if(c.amount--,c.amount<=0){const I=l.inventory.indexOf(c);l.inventory.splice(I,1)}y(d)}),["hpHeal","mpHeal","bothHeal"].includes(c.itemType)?(n.appendChild(p),$=!0,n.style.color="black"):c.itemType==="equipment"&&(s.appendChild(p),b=!0,s.style.color="black")}),$||(n.innerText="何も持っていない",n.style.color="gray",n.style.textAlign="center"),b||(s.innerText="何も持っていない",s.style.color="gray",s.style.textAlign="center"),a.innerHTML=`<h3>装備中アイテム</h3>
`,l.equipment.length>0?l.equipment.forEach(c=>{const p=document.createElement("button");let I="";c.effect.physicalStrength&&(I+=` 攻撃+${c.effect.physicalStrength}`),c.effect.defense&&(I+=` 防御+${c.effect.defense}`),p.textContent=`${c.name}${I}（クリックで外す）`,p.style.cursor="pointer",p.addEventListener("click",()=>{l.unequipItem(c),y(d)}),a.appendChild(p)}):a.innerHTML+="<p>未装備</p>"}const V=[{name:"スラッシュ",mpCost:5,type:"attack",power:e=>Math.floor(e.magicalStrength*1.3),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name} は、細切れにされた`,`${n.name} は倒れた！`)):r(`${t.name} は【${e}】で攻撃！ ${n.name} に ${s} ダメージ！`,`(${n.name}のHP：${n.hp})`)},Instruction:`名称：スラッシュ
 少しのオーラを纏った斬撃を放つ。ダメージはキャラクターの物理攻撃に依存する`},{name:"ファイアボール",mpCost:10,type:"attack",power:e=>Math.floor(e.magicalStrength*1.3),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name}は、炭火焼きにされた
 ${n.name} は倒れた！`)):r(`${t.name} は 【${e}】で攻撃！ ${n.name} に ${s} ダメージ！`,` (${n.name}のHP：${n.hp})`)},Instruction:`名称：ファイヤーボール
 炎の球を繰り出す。ダメージはキャラクターの精神力に依存する`},{name:"アイスランス",mpCost:12,type:"attack",power:e=>Math.floor(e.magicalStrength*1.5),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name}は、串刺の中、凍え死んだ... `,`${n.name} は倒れた！`)):r(`${t.name} は【${e}】で攻撃！ ${n.name} に ${s} ダメージ！`,` (${n.name}のHP：${n.hp})`)},Instruction:`名称：アイスランス
 氷の槍を繰り出す。ダメージはキャラクターの 精神力×1.5 に依存する`},{name:"自己再生",mpCost:8,type:"heal",element:"heal",power:()=>0,log:(e,t)=>{if(t.hp!==t.maxHp){const n=Math.floor(t.magicalStrength*1.5);t.hp=Math.min(t.maxHp,t.hp+n),r(`${t.name} は ${e} でHPを${n}回復！(${t.name}のHP：${t.hp})`)}else r(`${t.name} のHPは既に MAX です！`)},Instruction:`名称：自己再生
 自らの力で体力を回復するスキル。精神力依存`}],qe=[{name:"ファイアブラスト",mpCost:18,type:"attack",element:"fire",power:e=>Math.floor(e.magicalStrength*1.8),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${t.name} は 【${e}】で爆散した`,` ${n.name} は倒れた！`)):r(`${t.name} の【ファイアブラスト】が炸裂！`,`${n.name} に ${s} ダメージ！(現在のHP：${n.hp})`)},Instruction:`名称：ファイヤブラスト
 ダメージは精神力に依存する強力魔法`}],we=[{name:"次元斬",mpCost:35,type:"attack",element:"sword",power:e=>Math.floor(e.physicalStrength*2),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name}は、次元の狭間に葬り去られた`,` ${n.name} は倒れた！`)):r(`${t.name} は【${e}】で切り刻まれる！ ${n.name} に ${s} ダメージ！ (${n.name}のHP：${n.hp})`)},Instruction:`名称：次元斬
 高威力の物理攻撃。物理ステ依存`},{name:"インフェルノ",mpCost:50,type:"attack",element:"fire",power:e=>Math.floor(e.magicalStrength*2.5),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name}は、業火に包まれ、息たえた
 ${n.name} は倒れた！`)):r(`${t.name} の【${e}】が大地を焼き尽くす`,`${n.name} に ${s} ダメージ！ (現在のHP：${n.hp})`)},Instruction:`名称：インフェルノ
 fire elementの最終進化系。精神力依存`},{name:"アイステンペスト",mpCost:50,type:"attack",element:"ice",power:e=>Math.floor(e.magicalStrength*2.5),log:(e,t,n,s)=>{n.hp<=0?(n.hp=0,r(`${n.name}は、氷漬けにされた`,`${n.name} は倒れた！`)):r(`${t.name} の【${e}】が銀世界を創り出す`,`${n.name} に ${s} ダメージ！(${n.name}のHP：${n.hp})`)},Instruction:`名称：アイステンペスト
 氷属性の最終進化スキル。精神力依存`}],Ae=[...V,...qe,...we];let N=null,O=null;function fe(e,t,n){N=e,O=t,console.log(e),console.log(t)}function g(){if(!N)throw new Error("プレイヤーが設定されていません");return N}function v(){if(!O)throw new Error("敵が設定されていません");return O}let T;function Ce(e){T=e}function Ne(){return T}let j=1;function Oe(){Ee.style.display="",W.style.display="";const e=k[j],t=ee(e);fe(g(),t),he(),Te(T.skillDiv,V),y(d),T.defaultAttackBtn.style.display="",T.nextStageBtn.style.display="none",T.battleLogArea.style.display="",T.afterBattleLogArea.style.display="none",j++,ge(t)}function ge(e){de(`第 ${j} 階層`),f(`${e.name}が現れた！`,"どうする？")}const je=document.querySelector(".battle-area"),De=document.getElementById("game-over"),le=document.getElementById("game-reset");function Re(){je.style.display="none",De.style.display="",ze(),le&&le.addEventListener("click",()=>{window.location.href="safezone.html"})}function ze(){const e=g(),t={name:e.name,job:e.className,inventory:e.inventory};localStorage.setItem("saveData",JSON.stringify(t))}let P=1,Y=!1,Z=!1,D=!1,R=!1;function M(){Y=!0,h()}function $e(){Z=!0,h()}function z(){R||(R=!0,h())}function L(){U.style.display!==""&&(ye(),q.style.display="none",x.style.display="none",Y=!1,Z=!1,R=!1,D=!1,r(`--- ${P}ターン目 ---`))}function h(){Y&&Z&&!D&&(D=!0,P++,setTimeout(()=>{x.style.display="",q.style.display="",f(`${P}ターン目が終了…`,"次の行動を選べ")},1e3))}function Je(){P=1}function _(e,t=null,n=!1){if(e.hp>0||!n)return;const s=g();let a;if(s instanceof Object&&"inventory"in s)a=s;else return;const{defaultAttackBtn:o,nextStageBtn:l,toggleArea:m,battleLogArea:u,afterBattleLogArea:$,skillDiv:b}=Ne();if(m.style.display="",Ee.style.display="none",b.style.display="none",u.style.display="none",$.style.display="",e.hp=0,console.log(e.name),e.isPlayer)u.style.display="",$.style.display="none",r(`<h1>${e.name} は倒された</h1>`,"5秒後に引き継ぎアイテム選択画面に移動します"),setTimeout(Re,5e3);else{Ue(o,l,u,$),Je(),de("セーフティーエリア");const c=Math.floor(a.maxHp*.2),p=Math.floor(a.maxMp*.2);if(a.hp=Math.min(a.hp+c,a.maxHp),a.mp=Math.min(a.mp+p,a.maxMp),t&&l.style.display==="")ye(),r(`${e.name} は倒された`),r("次の階層まで安全だ。回復・装備・スキルを使って準備しよう。"),r(`勝利ボーナス！HPが${c}、MPが${p}回復した！`,""),pe(a);else if(l.style.display==="none"&&$.style.display==="none")f("外に出よう");else{r(`${e.name} は倒された`),r("次の階層まで安全だ。回復・装備・スキルを使って準備しよう。",""),r(`勝利ボーナス！HPが${c}、MPが${p}回復した！`,""),pe(a);return}y()}}let C=1;function Ue(e,t,n,s){const a=k[C];if(console.log(C,a),C++,a)e.style.display="none",t.style.display="";else{e.style.display="none",t.style.display="none",n.style.display="",s.style.display="none",f("ダンジョンクリア！！🎉","おめでとう！！！");return}}function J(e,t,n){const s=Ae[e],a=g();if(!s){f("スキルが見つかりません！","");return}const o=t,l=n;if(o.mp<s.mpCost){r(`${o.name}はスキルを発動！`,`しかし、${o.name} はMPが足りない！`);return}else o.mp-=s.mpCost;o.mp-=s.mpCost;const m=s.power(o);if(s.type==="heal"?s.log(s.name,o,l||null,s.power(o)):(l.hp-=m,s.log(s.name,o,l,s.power(o)),h()),l.hp>0&&o===a?(M(),B(1e3)):l.hp>0&&($e(),h()),l.hp<=0&&s.type!=="heal"){l.hp=0,y(d),setTimeout(()=>{const u=typeof s.log=="function"?()=>s.log(s.name,o,l,s.power(o)):null;setTimeout(()=>{_(l,u,!0)},1e3)},850);return}h(),y(d)}const ie=document.getElementById("instruction-border"),We=document.getElementById("instruction");function Te(e,t){e.innerText="",t.forEach((n,s)=>{const a=document.createElement("button");a.innerHTML=`${n.name} <br>（消費MP:${n.mpCost}）`,a.addEventListener("mouseover",()=>{ie.style.display="block",We.innerText=n.Instruction}),a.addEventListener("mouseleave",()=>{ie.style.display="none"}),a.addEventListener("click",()=>{L();const o=g(),l=v();z(),J(s,o,l)}),e.appendChild(a)}),y(d)}function Xe(e){e.addEventListener("click",()=>{L();const t=g(),n=v(),s=Math.max(t.physicalStrength-n.defense,1);if(n.hp-=s,n.hp<=0&&(n.hp=0),r(`${t.name} の攻撃！${n.name} に ${s} ダメージ！`,`(${n.name}のHP：${n.hp})`),y(d),n.hp<=0){setTimeout(()=>{_(n,null,!0)},1e3);return}else B(850);y(d),M(),h()})}function Fe(){const e=g();let t;if(e instanceof Object&&"inventory"in e)t=e;else throw new Error("Player の取得に失敗しました");const n=v();let s;if(n instanceof Object)s=n;else throw new Error("Enemy の取得に失敗しました");if(s.hp<=0)return;let a;if(s.hp>=s.maxHp*.7?a=Math.random()<.95?"attack":"heal":s.hp<=s.maxHp*.3?a=Math.random()<.4?"attack":"heal":a=Math.random()<.7?"attack":"heal",a==="attack")if(Math.random()<(s.hp>=s.maxHp*.7?.05:s.hp<=s.maxHp*.3?.5:.3)){const l=Math.floor(Math.random()*100),m=l<50?0:l<80?1:2;J(m,s,t),z()}else{const l=Math.max(s.physicalStrength-t.defense,1);if(t.hp-=l,r(`${s.name} の攻撃！
 ${t.name} は${l} ダメージを受けた！`,`(${t.name}のHP：${t.hp})`),t.hp<=0){he(),t.hp=0,_(t,null,!0);return}}else J(3,s,t),z();y(d),$e(),h()}function B(e=1e3){setTimeout(()=>{Fe()},e)}class Ke{constructor(t,n,s,a,o,l,m,u){i(this,"name");i(this,"className");i(this,"hp");i(this,"maxHp");i(this,"mp");i(this,"maxMp");i(this,"physicalStrength");i(this,"magicalStrength");i(this,"defense");i(this,"speed");i(this,"isPlayer",!0);i(this,"equipment",[]);i(this,"inventory",[]);this.name=t,this.className=n,this.hp=s,this.maxHp=s,this.mp=a,this.maxMp=a,this.physicalStrength=o,this.magicalStrength=l,this.defense=m,this.speed=u}getPlayerStatus(){return`${this.name}（${this.className}）：【HP ${this.hp}/${this.maxHp}】【MP ${this.mp}/${this.maxMp}】`}healItem(t){if(x.style.display="none",L(),M(),t.itemType==="hpHeal"){const n=t.effect.hp??0;this.hp=Math.min(this.hp+n,this.maxHp),r(`${this.name} は ${t.name} を使い、HPを${n}回復した！`,"")}else if(t.itemType==="mpHeal"){const n=t.effect.mp??0;this.mp=Math.min(this.mp+n,this.maxMp),r(`${this.name} は ${t.name} を使い、MPを${n}回復した！`,"")}else if(t.itemType==="bothHeal"){const n=t.effect.hp??0,s=t.effect.mp??0;this.hp=Math.min(this.hp+n,this.maxHp),this.mp=Math.min(this.mp+s,this.maxMp),r(`${this.name} は ${t.name} を使い、HP${n}・MP${s}回復した！`,"")}B(1e3)}equipItem(t){x.style.display="none",L(),M();const n=this.equipment.find(s=>s.equipmentType===t.equipmentType);if(n){this.unequipItem(n);return}this.physicalStrength+=t.effect.physicalStrength||0,this.defense+=t.effect.defense||0,this.speed+=t.effect.speed||0,t.isEquipped=!0,this.equipment.push(t),r(`${t.name} を装備した！`),B(1e3)}unequipItem(t){x.style.display="none",L(),M(),this.physicalStrength-=t.effect.physicalStrength||0,this.defense-=t.effect.defense||0,t.isEquipped=!1;const n=this.equipment.indexOf(t);n!==-1&&this.equipment.splice(n,1);const s=this.inventory.find(a=>a.name===t.name);s?s.amount+=1:this.inventory.push(new ne(t.name,t.itemType,t.equipmentType,t.effect,1,t.rarity,t.instructionText)),r(`${t.name} を外し、インベントリに戻した`),B(1e3)}}class Ge{constructor(t,n,s,a,o,l,m,u){i(this,"name");i(this,"className");i(this,"hp");i(this,"maxHp");i(this,"mp");i(this,"maxMp");i(this,"physicalStrength");i(this,"magicalStrength");i(this,"defense");i(this,"speed");i(this,"isPlayer",!1);this.name=t,this.className=n,this.hp=s,this.maxHp=s,this.mp=a,this.maxMp=a,this.physicalStrength=o,this.magicalStrength=l,this.defense=m,this.speed=u}getEnemyStatus(){return`${this.name}（${this.className}）：【HP ${this.hp}/${this.maxHp}】【MP ${this.mp}/${this.maxMp}】`}}function Qe(e,t){const n=ke[e];return new Ke(t,n.className,n.hp,n.mp,n.physicalStrength,n.magicalStrength,n.defense,n.speed)}function ee(e){return new Ge(e.name,e.className,e.hp,e.mp,e.physicalStrength,e.magicalStrength,e.defense,e.hitRate??80)}function Ve(){[{btnId:"toggle-heal-items",listId:"heal-items",label:"回復アイテム一覧"},{btnId:"toggle-equip-items",listId:"equip-items",label:"装備アイテム一覧"},{btnId:"toggle-skill-list",listId:"skill-list",label:"スキル一覧"},{btnId:"background-button",listId:"background-area",label:"バトルログ履歴"}].forEach(({btnId:t,listId:n,label:s})=>{const a=document.getElementById(t),o=document.getElementById(n);a.textContent=`▶︎ ${s}`,o.classList.add("hidden"),a.addEventListener("click",()=>{const l=o.classList.toggle("hidden");a.textContent=l?`▶︎ ${s}`:`▼ ${s}を閉じる`})})}function Ye(e,t){e.addEventListener("click",()=>{q.style.display="",t()})}const re=document.querySelector(".battle-area"),q=document.getElementById("toggle-area");document.getElementById("toggle-heal-items");document.getElementById("toggle-equip-items");const Ee=document.getElementById("toggle-skill-list"),ce=document.getElementById("battle-log"),me=document.getElementById("after-battle-log"),Ze=document.getElementById("player-status"),x=document.getElementById("default-attack"),U=document.getElementById("next-stage"),_e=document.getElementById("enemy-status"),et=document.getElementById("equipped-items"),W=document.getElementById("skill-list"),tt=document.getElementById("heal-items"),nt=document.getElementById("equip-items"),d={playerStatus:Ze,enemyStatus:_e,healItemsDiv:tt,equipItemsDiv:nt,equippedDiv:et};function st(){re.style.display="",Pe({battleLog:ce,afterBattleLog:me});const e=k[0],t=ee(e);ge(t),Te(W,V),Xe(x),Ve(),Ye(U,Oe),Ce({defaultAttackBtn:x,nextStageBtn:U,battleArea:re,toggleArea:q,battleLogArea:ce,afterBattleLogArea:me,skillDiv:W,uiElements:d}),y(d)}document.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("playerData"),t=location.pathname.includes("safezone.html");if(!e&&!t){alert("セーフティエリアからスタートしてください！"),window.location.href="safezone.html";return}if(e){const n=JSON.parse(e);at(n)}});function at(e){const t=Qe(e.jobIndex,e.name),n=[...e.equipment.map(a=>new ne(a.name,a.itemType,a.equipmentType??"",a.effect,a.amount??1,a.rarity,a.instructionText)),...e.items.map(a=>new xe(a.name,a.itemType,a.effect,a.amount??1,a.rarity,a.instructionText))];t.inventory=n;const s=ee(k[0]);fe(t,s),st()}const ot=[{name:"HPの実",itemType:"hpHeal",effect:{hp:30},amount:0,rarity:"common",instructionText:"レアリティ：一般級。HPを30回復する。"},{name:"HPジャム",itemType:"hpHeal",effect:{hp:80},amount:0,rarity:"uncommon",instructionText:"レアリティ：希少級。HPを80回復する。"},{name:"HPポーション",itemType:"hpHeal",effect:{hp:200},amount:0,rarity:"rare",instructionText:"レアリティ：上級。HPを200回復する。"},{name:"MPの実",itemType:"mpHeal",effect:{mp:10},amount:0,rarity:"common",instructionText:"レアリティ：一般級。MPを10回復する。"},{name:"MPジャム",itemType:"mpHeal",effect:{mp:30},amount:0,rarity:"uncommon",instructionText:"レアリティ：希少級。MPを30回復する。"},{name:"MPポーション",itemType:"mpHeal",effect:{mp:60},amount:0,rarity:"rare",instructionText:"レアリティ：上級。MPを60回復する。"},{name:"エリクサー",itemType:"bothHeal",effect:{hp:500,mp:500},amount:0,rarity:"legendary",instructionText:"レアリティ：伝説級。MPを500回復する。"}],lt=[{name:"木の棒",itemType:"equipment",equipmentType:"sword",effect:{physicalStrength:5},amount:0,rarity:"common",instructionText:"分類：剣。 レアリティ：一般。 攻撃力＋５"},{name:"欠けた鉄鎧",itemType:"equipment",equipmentType:"armor",effect:{defense:8,speed:-3},amount:0,rarity:"rare",instructionText:"分類：鎧。 レアリティ：上級。 防御力＋８、スピード−３"},{name:"ハゲた兜",itemType:"equipment",equipmentType:"helmet",effect:{defense:4},amount:0,rarity:"uncommon",instructionText:"分類：兜。 レアリティ：希少級。 防御力＋４"},{name:"穴の空いた革靴",itemType:"equipment",equipmentType:"shoes",effect:{defense:2,speed:5},amount:0,rarity:"common",instructionText:"分類：靴。 レアリティ：一般級。 防御力＋４"},{name:"弦が切れそうな弓",itemType:"equipment",equipmentType:"bow",effect:{physicalStrength:10,hitRate:-5},amount:0,rarity:"rare",instructionText:"分類：剣。 レアリティ：上級。 攻撃力＋50。"},{name:"エクスカリバー",itemType:"equipment",equipmentType:"sword",effect:{physicalStrength:50},amount:0,rarity:"legendary",instructionText:"分類：剣。 レアリティ：伝説級。 攻撃力＋50。"}];class te{constructor(t,n,s,a,o,l){i(this,"name");i(this,"itemType");i(this,"effect");i(this,"amount");i(this,"rarity");i(this,"instructionText");i(this,"isEquipped",!1);this.name=t,this.itemType=n,this.effect=s,this.amount=a,this.rarity=o,this.instructionText=l}showAmount(){return`${this.name}：${this.amount} 個`}}class xe extends te{}class ne extends te{constructor(n,s,a,o,l,m,u){super(n,s,o,l,m,u);i(this,"equipmentType");this.equipmentType=a,this.isEquipped=!1}}const se=ot.map(e=>new xe(e.name,e.itemType,e.effect,e.amount,e.rarity,e.instructionText)),ae=lt.map(e=>new ne(e.name,e.itemType,e.equipmentType??null,e.effect,e.amount,e.rarity,e.instructionText)),it=[...se,...ae];function rt(e,t){const n=t.reduce((o,l)=>o+l,0),s=Math.random()*n;let a=0;for(let o=0;o<e.length;o++)if(a+=t[o],s<a)return e[o];return e[e.length-1]}function pe(e){const t=it,n={common:.6,uncommon:.3,rare:.15,epic:.05,legendary:.02},s=t.map(l=>n[l.rarity]||.6),a=rt(t,s);console.log("【DEBUG】選ばれたdroppedItem：",a);const o=e.inventory.find(l=>l.name===a.name);o?o.amount+=1:e.inventory.push(new te(a.name,a.itemType,a.effect,1,a.rarity,a.instructionText)),f(`ドロップ報酬：${a.name}（${a.rarity}）を手に入れた！`,""),y(d)}const w=document.getElementById("lobby"),X=document.getElementById("select-player-area"),F=document.getElementById("shop-area"),He=document.getElementById("cooking-area"),ct=document.getElementById("cooking-btn"),mt=document.querySelectorAll(".safety-area-btn"),pt=document.getElementById("shop-btn"),ut=document.getElementById("prepare-battle-btn");ut.addEventListener("click",()=>{console.log(X),w.style.display="none",X.style.display="block"});mt.forEach(e=>{e.addEventListener("click",()=>{w.style.display="block",X.style.display="none",F.style.display="none",He.style.display="none"})});pt.addEventListener("click",()=>{F.style.display="block",w.style.display="none",console.log(F)});ct.addEventListener("click",()=>{w.style.display="none",He.style.display="block"});document.getElementById("start-button-buttle").addEventListener("click",()=>{const e=document.getElementById("player-name-input").value.trim(),t=oe;if(!e||!t){alert("名前と職業は必須です！");return}const n=Ie.map(o=>({...ae[o],amount:1})),s=Me.map(o=>({...se[o],amount:1})),a={name:e,job:t,jobIndex:t==="戦士"?0:1,equipment:n,items:s};localStorage.setItem("playerData",JSON.stringify(a)),window.location.href="battleDisplay.html"});let oe=null;const K=document.getElementById("select-warrior"),G=document.getElementById("select-mage");K.addEventListener("click",()=>{oe="戦士",Se(K,G)});G.addEventListener("click",()=>{oe="魔法使い",Se(G,K)});function Se(e,t){e.classList.add("selected-class"),t.classList.remove("selected-class")}const Ie=[],Me=[],dt=document.getElementById("equipment-options"),yt=document.getElementById("heal-item-options"),ht=ae.filter(e=>e.rarity==="common"),ft=se.filter(e=>e.rarity==="common");Le(ht,dt,Ie,2);Le(ft,yt,Me,2);function Le(e,t,n,s){e.forEach((a,o)=>{const l=document.createElement("button");l.textContent=a.name,l.addEventListener("click",()=>{const m=n.indexOf(o);if(m!==-1)n.splice(m,1),l.classList.remove("selected-class");else{if(n.length>=s){alert(`最大${s}つまで選べます`);return}n.push(o),l.classList.add("selected-class")}}),t.appendChild(l)})}
